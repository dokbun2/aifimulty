<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í† ë¦¬ë³´ë“œ ë°±ì—… ë³µì› í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #007AFF;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #fff;
        }
        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Monaco', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #10B981;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #EF4444;
        }
        .warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #FCD34D;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60A5FA;
        }
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-right: 10px;
        }
        button:hover {
            background: #0051D5;
        }
        .file-input {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
        }
        .file-input:hover {
            background: rgba(255, 255, 255, 0.12);
        }
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ìŠ¤í† ë¦¬ë³´ë“œ ë°±ì—… ë³µì› í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <div class="test-title">1ï¸âƒ£ JSON íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸</div>
        <label class="file-input">
            <input type="file" id="jsonFileInput" accept=".json">
            JSON íŒŒì¼ ì„ íƒ
        </label>
        <button onclick="loadSampleData()">ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ</button>
        <div id="loadResult" class="test-result info" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <div class="test-title">2ï¸âƒ£ ì‹œí€€ìŠ¤ë³„ ìƒ· ë°ì´í„° ë¶„ì„</div>
        <button onclick="analyzeShots()">ìƒ· ë°ì´í„° ë¶„ì„</button>
        <div id="shotAnalysis" class="test-result info" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <div class="test-title">3ï¸âƒ£ ìƒ· ë Œë”ë§ ì‹œë®¬ë ˆì´ì…˜</div>
        <button onclick="simulateRendering()">ë Œë”ë§ ì‹œë®¬ë ˆì´ì…˜</button>
        <div id="renderSimulation" class="test-result info" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <div class="test-title">4ï¸âƒ£ ë¬¸ì œ ì§„ë‹¨ ë° í•´ê²° í™•ì¸</div>
        <button onclick="diagnoseIssues()">ë¬¸ì œ ì§„ë‹¨</button>
        <div id="issuesDiagnosis" class="test-result info" style="display: none;"></div>
    </div>

    <script>
        let testData = null;
        
        // JSON íŒŒì¼ ë¡œë“œ
        document.getElementById('jsonFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    testData = JSON.parse(event.target.result);
                    showLoadResult(testData);
                } catch (error) {
                    showResult('loadResult', `âŒ JSON íŒŒì‹± ì˜¤ë¥˜: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        });
        
        // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ
        function loadSampleData() {
            // ê°„ë‹¨í•œ ìƒ˜í”Œ ë°ì´í„°
            testData = {
                breakdown_data: {
                    sequences: [
                        { id: "SEQ1", title: "ì‹œí€€ìŠ¤ 1" },
                        { id: "SEQ2", title: "ì‹œí€€ìŠ¤ 2" }
                    ],
                    scenes: [
                        { id: "S01", sequence_id: "SEQ1", title: "ì”¬ 1", shot_ids: ["S01.01", "S01.02", "S01.03"] },
                        { id: "S02", sequence_id: "SEQ1", title: "ì”¬ 2", shot_ids: ["S02.01", "S02.02"] },
                        { id: "S03", sequence_id: "SEQ2", title: "ì”¬ 3", shot_ids: ["S03.01", "S03.02", "S03.03", "S03.04"] }
                    ],
                    shots: [
                        { id: "S01.01", scene_id: "S01", title: "ì´êµ¬ í™”ì—¼ê³¼ ê²©ë ¬í•œ ì „íˆ¬" },
                        { id: "S01.02", scene_id: "S01", title: "ì•„ìˆ˜ë¼ì¥ ë³µë„" },
                        { id: "S01.03", scene_id: "S01", title: "ì¢€ë¹„ì™€ì˜ ê²©íˆ¬" },
                        { id: "S02.01", scene_id: "S02", title: "ë³µë„ ì§ˆì£¼" },
                        { id: "S02.02", scene_id: "S02", title: "ì†ëª© ë‹¨ë§ê¸° í´ë¡œì¦ˆì—…" },
                        { id: "S03.01", scene_id: "S03", title: "ë°”ì´ì˜¤ë© ë„ì°©" },
                        { id: "S03.02", scene_id: "S03", title: "ì ê¸ˆ í•´ì œ ì‹œë„" },
                        { id: "S03.03", scene_id: "S03", title: "ë°œì†Œë¦¬" },
                        { id: "S03.04", scene_id: "S03", title: "ê±°ëŒ€í•œ ì‹¤ë£¨ì—£" }
                    ]
                }
            };
            showLoadResult(testData);
        }
        
        function showLoadResult(data) {
            let result = 'âœ… JSON ë°ì´í„° ë¡œë“œ ì™„ë£Œ\n\n';
            
            if (data.breakdown_data) {
                const bd = data.breakdown_data;
                result += `ğŸ“Š ë°ì´í„° êµ¬ì¡°:\n`;
                result += `  - ì‹œí€€ìŠ¤: ${bd.sequences ? bd.sequences.length : 0}ê°œ\n`;
                result += `  - ì”¬: ${bd.scenes ? bd.scenes.length : 0}ê°œ\n`;
                result += `  - ìƒ·: ${bd.shots ? bd.shots.length : 0}ê°œ\n\n`;
                
                if (bd.sequences) {
                    result += `ğŸ“ ì‹œí€€ìŠ¤ ëª©ë¡:\n`;
                    bd.sequences.forEach(seq => {
                        result += `  - ${seq.id}: ${seq.title}\n`;
                    });
                }
            }
            
            showResult('loadResult', result, 'success');
        }
        
        // ìƒ· ë°ì´í„° ë¶„ì„
        function analyzeShots() {
            if (!testData || !testData.breakdown_data) {
                showResult('shotAnalysis', 'âš ï¸ ë¨¼ì € JSON íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”', 'warning');
                return;
            }
            
            const bd = testData.breakdown_data;
            let result = 'ğŸ“Š ìƒ· ë°ì´í„° ë¶„ì„\n\n';
            
            // shots ë°°ì—´ ë¶„ì„
            if (bd.shots) {
                result += `âœ… shots ë°°ì—´ ì¡´ì¬ (${bd.shots.length}ê°œ)\n\n`;
                
                const shotsById = {};
                bd.shots.forEach(shot => {
                    shotsById[shot.id] = shot;
                    result += `  - ${shot.id}: "${shot.title}" (scene_id: ${shot.scene_id})\n`;
                });
                result += '\n';
            } else {
                result += 'âŒ shots ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤!\n\n';
            }
            
            // ì”¬ë³„ shot_ids ë¶„ì„
            if (bd.scenes) {
                result += 'ğŸ“ ì”¬ë³„ shot_ids ë¶„ì„:\n';
                bd.scenes.forEach(scene => {
                    result += `\n  ì”¬ ${scene.id}: ${scene.title}\n`;
                    if (scene.shot_ids && scene.shot_ids.length > 0) {
                        result += `    shot_ids: [${scene.shot_ids.join(', ')}]\n`;
                        
                        scene.shot_ids.forEach(shotId => {
                            const shot = bd.shots?.find(s => s.id === shotId);
                            if (shot) {
                                result += `      âœ… ${shotId}: "${shot.title}" - ë°ì´í„° ìˆìŒ\n`;
                            } else {
                                result += `      âŒ ${shotId}: shots ë°°ì—´ì— ì—†ìŒ - ê¸°ë³¸ê°’ ì‚¬ìš©ë¨\n`;
                            }
                        });
                    } else {
                        result += `    âš ï¸ shot_idsê°€ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìŒ\n`;
                    }
                });
            }
            
            showResult('shotAnalysis', result, 'info');
        }
        
        // ë Œë”ë§ ì‹œë®¬ë ˆì´ì…˜
        function simulateRendering() {
            if (!testData || !testData.breakdown_data) {
                showResult('renderSimulation', 'âš ï¸ ë¨¼ì € JSON íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”', 'warning');
                return;
            }
            
            const bd = testData.breakdown_data;
            let result = 'ğŸ¨ ìƒ· ë Œë”ë§ ì‹œë®¬ë ˆì´ì…˜\n\n';
            
            // loadShotsForScene í•¨ìˆ˜ ì‹œë®¬ë ˆì´ì…˜
            if (bd.scenes) {
                bd.scenes.forEach(scene => {
                    result += `\nğŸ“ ì”¬ ${scene.id} ë Œë”ë§:\n`;
                    
                    let shots = [];
                    
                    // ë°©ë²• 1: shots ë°°ì—´ì—ì„œ scene_idë¡œ í•„í„°ë§
                    if (bd.shots) {
                        shots = bd.shots.filter(shot => shot.scene_id === scene.id);
                        result += `  ë°©ë²• 1: shots ë°°ì—´ì—ì„œ ${shots.length}ê°œ ì°¾ìŒ\n`;
                    }
                    
                    // ë°©ë²• 2: scene.shot_ids ì‚¬ìš©
                    if (shots.length === 0 && scene.shot_ids && scene.shot_ids.length > 0) {
                        result += `  ë°©ë²• 2: scene.shot_ids ì‚¬ìš© (${scene.shot_ids.length}ê°œ)\n`;
                        
                        shots = scene.shot_ids.map((shotId, index) => {
                            const existingShot = bd.shots?.find(s => s.id === shotId);
                            if (existingShot) {
                                result += `    âœ… ${shotId}: "${existingShot.title}" í‘œì‹œ\n`;
                                return existingShot;
                            }
                            
                            // ê°œì„ ëœ ê¸°ë³¸ê°’ ìƒì„±
                            let shotTitle = `ìƒ· ${index + 1}`;
                            if (shotId && shotId.includes('.')) {
                                const parts = shotId.split('.');
                                if (parts.length === 2) {
                                    shotTitle = `ìƒ· ${parts[1]}`;
                                }
                            }
                            
                            result += `    âš ï¸ ${shotId}: ê¸°ë³¸ê°’ "${shotTitle}" ì‚¬ìš©\n`;
                            return { id: shotId, title: shotTitle, scene_id: scene.id };
                        });
                    }
                    
                    if (shots.length === 0) {
                        result += `  âŒ ìƒ·ì´ ì—†ìŠµë‹ˆë‹¤\n`;
                    } else {
                        result += `  ìµœì¢…: ${shots.length}ê°œ ìƒ· ë Œë”ë§\n`;
                    }
                });
            }
            
            showResult('renderSimulation', result, 'info');
        }
        
        // ë¬¸ì œ ì§„ë‹¨
        function diagnoseIssues() {
            if (!testData || !testData.breakdown_data) {
                showResult('issuesDiagnosis', 'âš ï¸ ë¨¼ì € JSON íŒŒì¼ì„ ë¡œë“œí•˜ì„¸ìš”', 'warning');
                return;
            }
            
            const bd = testData.breakdown_data;
            let issues = [];
            let fixes = [];
            
            // shots ë°°ì—´ ì²´í¬
            if (!bd.shots || bd.shots.length === 0) {
                issues.push('âŒ shots ë°°ì—´ì´ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìŒ');
                fixes.push('ğŸ“Œ ë°±ì—… íŒŒì¼ì— shots ë°ì´í„°ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸');
            }
            
            // ì”¬ë³„ shot_idsì™€ shots ë§¤ì¹­ ì²´í¬
            if (bd.scenes) {
                bd.scenes.forEach(scene => {
                    if (scene.shot_ids && scene.shot_ids.length > 0) {
                        scene.shot_ids.forEach(shotId => {
                            if (!bd.shots?.find(s => s.id === shotId)) {
                                issues.push(`âš ï¸ ${scene.id}ì˜ shot_id "${shotId}"ê°€ shots ë°°ì—´ì— ì—†ìŒ`);
                            }
                        });
                    }
                });
            }
            
            let result = 'ğŸ” ë¬¸ì œ ì§„ë‹¨ ê²°ê³¼\n\n';
            
            if (issues.length === 0) {
                result += 'âœ… ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!\n';
                result += 'ëª¨ë“  ìƒ· ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ ë§¤ì¹­ë˜ê³  ìˆìŠµë‹ˆë‹¤.\n';
            } else {
                result += 'ë°œê²¬ëœ ë¬¸ì œ:\n';
                issues.forEach(issue => {
                    result += `  ${issue}\n`;
                });
                
                if (fixes.length > 0) {
                    result += '\nê¶Œì¥ í•´ê²° ë°©ë²•:\n';
                    fixes.forEach(fix => {
                        result += `  ${fix}\n`;
                    });
                }
            }
            
            result += '\nâœ… ì ìš©ëœ ìˆ˜ì •ì‚¬í•­:\n';
            result += '1. loadShotsForScene í•¨ìˆ˜ì—ì„œ shot_ids ê¸°ë°˜ ë Œë”ë§ ê°œì„ \n';
            result += '2. ìƒ· ì œëª©ì´ ì—†ì„ ë•Œ shotIdë¡œë¶€í„° ì˜ë¯¸ìˆëŠ” ì œëª© ìƒì„±\n';
            result += '3. ë””ë²„ê¹…ì„ ìœ„í•œ ì½˜ì†” ë¡œê·¸ ì¶”ê°€\n';
            result += '4. ë°±ì—… ë³µì› ì‹œ shots ë°ì´í„° í™•ì¸ ë¡œì§ ê°•í™”\n';
            
            showResult('issuesDiagnosis', result, issues.length === 0 ? 'success' : 'warning');
        }
        
        function showResult(elementId, text, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `test-result ${type}`;
            element.style.display = 'block';
        }
    </script>
</body>
</html>