<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° - UI Enhanced</title>
    
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/x-icon" href="favicon_io/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    
    <style>
        /* UI Design Component ìŠ¤íƒ€ì¼ ì‹œìŠ¤í…œ */
        :root {
            /* Colors from UI Design System */
            --color-brand: #6366f1;
            --color-brand-accent: #818cf8;
            --color-brand-light: #a5b4fc;
            --color-brand-dark: #4f46e5;
            
            --bg-primary: #0a0a0b;
            --bg-secondary: #111113;
            --bg-tertiary: #1a1a1d;
            --bg-quaternary: #222227;
            
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-tertiary: #71717a;
            --text-quaternary: #52525b;
            
            --border-primary: rgba(255, 255, 255, 0.08);
            --border-secondary: rgba(255, 255, 255, 0.12);
            --border-tertiary: rgba(255, 255, 255, 0.16);
            
            --status-red: #ef4444;
            --status-green: #10b981;
            --status-yellow: #f59e0b;
            --status-blue: #3b82f6;
            --status-purple: #8b5cf6;
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', 'Paperlogy', sans-serif;
            --font-size-mini: 11px;
            --font-size-small: 13px;
            --font-size-regular: 14px;
            --font-size-medium: 16px;
            --font-size-large: 18px;
            --font-size-title: 20px;
            --font-size-title-2: 24px;
            
            /* Animations */
            --duration-quick: 150ms;
            --duration-normal: 250ms;
            --duration-slow: 400ms;
            --ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Shadows */
            --shadow-small: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-medium: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-large: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            
            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        /* UI Button Component */
        .ui-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            font-weight: 500;
            font-size: var(--font-size-small);
            border-radius: var(--radius-md);
            transition: all var(--duration-quick) var(--ease-out-quad);
            cursor: pointer;
            border: 1px solid transparent;
            outline: none;
            position: relative;
            white-space: nowrap;
            font-family: var(--font-family);
        }
        
        .ui-button:focus-visible {
            outline: 2px solid var(--color-brand);
            outline-offset: 2px;
        }
        
        .ui-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        /* Button Variants */
        .ui-button--primary {
            background: var(--color-brand);
            color: white;
            border-color: transparent;
        }
        
        .ui-button--primary:hover:not(:disabled) {
            background: var(--color-brand-accent);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .ui-button--secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-secondary);
        }
        
        .ui-button--secondary:hover:not(:disabled) {
            background: var(--bg-quaternary);
            border-color: var(--border-tertiary);
        }
        
        .ui-button--ghost {
            background: transparent;
            color: var(--text-secondary);
            border-color: transparent;
        }
        
        .ui-button--ghost:hover:not(:disabled) {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .ui-button--success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--status-green);
            border-color: rgba(16, 185, 129, 0.2);
        }
        
        .ui-button--success:hover:not(:disabled) {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .ui-button--ai {
            background: linear-gradient(135deg, var(--status-purple) 0%, #7c3aed 100%);
            color: white;
            border-color: transparent;
        }
        
        .ui-button--ai:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }
        
        /* Button Sizes */
        .ui-button--sm {
            height: 28px;
            padding: 0 12px;
            font-size: var(--font-size-small);
        }
        
        .ui-button--md {
            height: 36px;
            padding: 0 var(--space-md);
            font-size: var(--font-size-regular);
        }
        
        .ui-button--lg {
            height: 44px;
            padding: 0 var(--space-lg);
            font-size: var(--font-size-medium);
        }
        
        /* UI Card Component */
        .ui-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            transition: all var(--duration-quick) var(--ease-out-quad);
        }
        
        .ui-card--elevated {
            background: var(--bg-tertiary);
            border-color: var(--border-secondary);
            box-shadow: var(--shadow-medium);
        }
        
        .ui-card-header {
            padding-bottom: var(--space-md);
            margin-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ui-card-title {
            font-size: var(--font-size-large);
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        /* UI Input Component */
        .ui-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }
        
        .ui-input-label {
            font-size: var(--font-size-small);
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .ui-input {
            height: 36px;
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: 0 12px;
            color: var(--text-primary);
            font-size: var(--font-size-regular);
            font-family: var(--font-family);
            transition: all var(--duration-quick) var(--ease-out-quad);
        }
        
        .ui-input:hover {
            border-color: var(--border-secondary);
            background: rgba(255, 255, 255, 0.03);
        }
        
        .ui-input:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .ui-textarea {
            min-height: 100px;
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: var(--space-sm) 12px;
            color: var(--text-primary);
            font-size: var(--font-size-regular);
            font-family: var(--font-family);
            resize: vertical;
            transition: all var(--duration-quick) var(--ease-out-quad);
        }
        
        .ui-textarea:hover {
            border-color: var(--border-secondary);
            background: rgba(255, 255, 255, 0.03);
        }
        
        .ui-textarea:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Navigation */
        .nav-header {
            background: rgba(17, 17, 19, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-md) var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .nav-brand {
            font-size: var(--font-size-large);
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            letter-spacing: 0.5px;
        }
        
        .nav-menu {
            display: flex;
            gap: var(--space-lg);
            list-style: none;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: var(--font-size-regular);
            transition: color var(--duration-quick);
        }
        
        .nav-link:hover {
            color: var(--text-primary);
        }
        
        /* Main Container */
        .main-container {
            max-width: 1280px;
            margin: 0 auto;
            padding: var(--space-lg);
        }
        
        /* Sections */
        .section {
            margin-bottom: var(--space-2xl);
        }
        
        .section-header {
            margin-bottom: var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            font-size: var(--font-size-title);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Prompt Preview */
        .prompt-preview {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            min-height: 120px;
            font-size: var(--font-size-regular);
            line-height: 1.6;
            color: var(--text-primary);
            transition: all var(--duration-quick);
        }
        
        .prompt-preview:hover {
            border-color: var(--border-secondary);
        }
        
        .prompt-preview:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .prompt-preview[contenteditable="true"] {
            cursor: text;
        }
        
        /* Structure Tabs */
        .structure-tabs {
            margin-bottom: var(--space-lg);
        }
        
        .structure-tab-buttons {
            display: flex;
            gap: var(--space-xs);
            border-bottom: 2px solid var(--border-primary);
            padding-bottom: 2px;
        }
        
        .structure-tab-button {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: var(--space-sm) var(--space-lg);
            font-size: var(--font-size-regular);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--duration-quick);
            position: relative;
        }
        
        .structure-tab-button:hover {
            color: var(--text-primary);
        }
        
        .structure-tab-button.active {
            color: var(--color-brand);
        }
        
        .structure-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--color-brand);
        }
        
        /* Sub Tabs */
        .character-sub-tabs {
            margin-bottom: var(--space-lg);
        }
        
        .sub-tab-buttons {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .sub-tab-button {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-full);
            padding: 6px 16px;
            color: var(--text-secondary);
            font-size: var(--font-size-small);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--duration-quick);
        }
        
        .sub-tab-button:hover {
            background: var(--bg-quaternary);
            color: var(--text-primary);
            border-color: var(--border-secondary);
        }
        
        .sub-tab-button.active {
            background: var(--color-brand);
            color: white;
            border-color: var(--color-brand);
        }
        
        /* Dropdown Containers */
        .dropdown-container {
            margin-bottom: var(--space-md);
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: all var(--duration-normal);
        }
        
        .dropdown-container:hover {
            border-color: var(--border-secondary);
            box-shadow: var(--shadow-medium);
        }
        
        .dropdown-container.active {
            border-color: var(--color-brand);
            box-shadow: 0 0 0 1px var(--color-brand);
        }
        
        .dropdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: var(--bg-tertiary);
            cursor: pointer;
            user-select: none;
            transition: all var(--duration-quick);
        }
        
        .dropdown-header:hover {
            background: var(--bg-quaternary);
        }
        
        .dropdown-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            font-size: var(--font-size-regular);
        }
        
        .dropdown-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--color-brand);
            color: white;
            border-radius: var(--radius-full);
            font-size: var(--font-size-small);
            font-weight: 700;
        }
        
        .dropdown-arrow {
            color: var(--text-tertiary);
            transition: transform var(--duration-quick);
        }
        
        .dropdown-container.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--duration-normal) var(--ease-out-quad);
        }
        
        .dropdown-container.active .dropdown-content {
            max-height: 500px;
        }
        
        .dropdown-fields {
            padding: var(--space-lg);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
        }
        
        @media (max-width: 768px) {
            .dropdown-fields {
                grid-template-columns: 1fr;
            }
        }
        
        .dropdown-field {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }
        
        .dropdown-field-label {
            font-size: var(--font-size-small);
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .dropdown-field-label-with-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }
        
        .field-action-buttons {
            display: flex;
            gap: var(--space-xs);
        }
        
        .btn-field-action {
            padding: 4px 8px;
            font-size: var(--font-size-mini);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--duration-quick);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .btn-save {
            background: var(--status-green);
            color: white;
        }
        
        .btn-save:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .btn-ai-save {
            background: var(--status-purple);
            color: white;
        }
        
        .btn-ai-save:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }
        
        /* Select Input Wrapper */
        .select-input-wrapper {
            position: relative;
            width: 100%;
        }
        
        .dropdown-field-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: var(--font-size-small);
            transition: all var(--duration-quick);
        }
        
        .dropdown-field-input:hover {
            border-color: var(--border-secondary);
        }
        
        .dropdown-field-input:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .dropdown-field-input.with-select {
            padding-right: 35px;
        }
        
        .dropdown-toggle-btn {
            position: absolute;
            right: 1px;
            top: 1px;
            bottom: 1px;
            width: 30px;
            background: var(--color-brand);
            border: none;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--duration-quick);
        }
        
        .dropdown-toggle-btn:hover {
            background: var(--color-brand-dark);
        }
        
        .dropdown-toggle-btn.active {
            background: var(--color-brand-dark);
        }
        
        .style-options-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            max-height: 300px;
            overflow: hidden;
            display: none;
        }
        
        .style-options-search {
            padding: var(--space-sm);
            border-bottom: 1px solid var(--border-primary);
        }
        
        .style-options-search input {
            width: 100%;
            padding: 6px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: var(--font-size-small);
        }
        
        .style-options-list {
            overflow-y: auto;
            max-height: 250px;
        }
        
        .style-option {
            padding: 10px 14px;
            cursor: pointer;
            transition: all var(--duration-quick);
            font-size: var(--font-size-small);
            color: var(--text-secondary);
        }
        
        .style-option:hover {
            background: var(--bg-quaternary);
            color: var(--text-primary);
            padding-left: 18px;
        }
        
        .style-option.selected {
            background: rgba(99, 102, 241, 0.1);
            color: var(--color-brand);
            font-weight: 500;
        }
        
        .style-option.hidden {
            display: none;
        }
        
        /* Button Group */
        .button-group {
            display: flex;
            gap: var(--space-sm);
            justify-content: center;
            flex-wrap: wrap;
            margin-top: var(--space-lg);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            background: var(--bg-quaternary);
            color: var(--text-primary);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transform: translateX(400px);
            opacity: 0;
            transition: all var(--duration-normal) var(--ease-out-quad);
            z-index: 1000;
            border: 1px solid var(--border-secondary);
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--status-green);
        }
        
        .toast.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--status-red);
        }
        
        .toast.info {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: var(--status-blue);
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }
        
        .modal-header {
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-primary);
            padding: var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: var(--font-size-large);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-size: 24px;
            cursor: pointer;
            transition: all var(--duration-quick);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
        }
        
        .modal-close:hover {
            background: var(--bg-quaternary);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: var(--space-lg);
            overflow-y: auto;
            max-height: calc(90vh - 200px);
        }
        
        .modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border-primary);
            background: var(--bg-tertiary);
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
        }
        
        /* Utility Classes */
        .hidden {
            display: none !important;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--space-md);
            }
            
            .nav-menu {
                display: none;
            }
            
            .section-header {
                flex-direction: column;
                gap: var(--space-md);
                align-items: flex-start;
            }
            
            .button-group {
                width: 100%;
            }
            
            .ui-button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-header">
        <div class="nav-content">
            <div style="display: flex; align-items: center; gap: 20px;">
                <a href="index.html" class="nav-link" style="display: flex; align-items: center; gap: 6px;">
                    <i class="ti ti-home" style="font-size: 18px;"></i>
                    í™ˆ
                </a>
            </div>
            <a href="#" class="nav-brand">IMAGE PROMPT GENERATOR</a>
            <ul class="nav-menu">
                <li><a href="storyboard/index.html" class="nav-link">ìŠ¤í† ë¦¬ë³´ë“œ</a></li>
                <li><a href="concept-art/index.html" class="nav-link">ì»¨ì…‰ì•„íŠ¸</a></li>
                <li><a href="media-gallery-apple.html" class="nav-link">ê°¤ëŸ¬ë¦¬</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- ìš”ì²­ì‚¬í•­ ì…ë ¥ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">ìš”ì²­ì‚¬í•­ ì…ë ¥</h2>
                <button class="ui-button ui-button--primary ui-button--md" id="ai-connect-btn">
                    AI ì—°ë™
                </button>
            </div>

            <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì˜ì—­ -->
            <div class="ui-card" style="margin-bottom: var(--space-lg);">
                <div class="ui-card-header">
                    <h3 class="ui-card-title">í”„ë¡¬í”„íŠ¸ ì…ë ¥</h3>
                    <button class="ui-button ui-button--ghost ui-button--sm" onclick="clearPromptInput()" title="í”„ë¡¬í”„íŠ¸ ì´ˆê¸°í™”">
                        <i class="ti ti-refresh"></i>
                    </button>
                </div>
                <div class="prompt-preview" id="prompt-preview" contenteditable="true" spellcheck="false"></div>
            </div>

            <!-- êµ¬ì¡°ë³„ ì¹´ë“œ ì„¹ì…˜ -->
            <div class="ui-card ui-card--elevated">
                <div class="ui-card-header">
                    <h3 class="ui-card-title">ğŸ¯ í”„ë¡¬í”„íŠ¸ êµ¬ì¡° í¸ì§‘ê¸°</h3>
                    <button class="ui-button ui-button--primary ui-button--sm" onclick="importPromptFromPreview()">
                        ê°€ì ¸ì˜¤ê¸°
                    </button>
                </div>
                
                <!-- êµ¬ì¡° í¸ì§‘ê¸° íƒ­ -->
                <div class="structure-tabs">
                    <div class="structure-tab-buttons">
                        <button type="button" class="structure-tab-button active" id="structure-tab-character" onclick="switchStructureTab('character')">ìºë¦­í„°</button>
                        <button type="button" class="structure-tab-button" id="structure-tab-general" onclick="switchStructureTab('general')">ì¼ë°˜ì´ë¯¸ì§€</button>
                    </div>
                </div>
                
                <div class="prompt-cards-grid" id="prompt-cards-grid">
                    <!-- ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="button-group">
                <button class="ui-button ui-button--primary ui-button--lg" id="generate-prompt-btn">
                    <i class="ti ti-layers"></i>
                    í”„ë¡¬í”„íŠ¸ ìƒì„±
                </button>
                <button class="ui-button ui-button--ai ui-button--lg" id="ai-generate-prompt-btn" onclick="if(window.generateAIPrompt) { window.generateAIPrompt(); }">
                    <i class="ti ti-sparkles"></i>
                    AI í”„ë¡¬í”„íŠ¸ ìƒì„±
                </button>
            </div>
        </div>

        <!-- ìµœì¢… í”„ë¡¬í”„íŠ¸ ì„¹ì…˜ -->
        <div class="section" id="final-prompt-section" style="display:none;">
            <div class="ui-card">
                <div class="ui-card-header">
                    <h2 class="ui-card-title">ìµœì¢… í”„ë¡¬í”„íŠ¸</h2>
                </div>
                <textarea id="final-prompt-text" class="ui-textarea" placeholder="ìµœì¢… í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤." readonly></textarea>
                <div class="button-group" style="margin-top: var(--space-md);">
                    <button class="ui-button ui-button--success ui-button--md" id="copy-final-prompt-btn">
                        <i class="ti ti-copy"></i>
                        í”„ë¡¬í”„íŠ¸ ë³µì‚¬
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Message -->
    <div class="toast" id="toast">
        <i class="ti ti-check" id="toast-icon"></i>
        <span id="toast-message"></span>
    </div>

    <!-- AI ì—°ë™ Modal -->
    <div class="modal-overlay" id="aiModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">AI API ì„¤ì •</h3>
                <button class="modal-close" onclick="closeAIModal()">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="ui-input-group" style="margin-bottom: var(--space-lg);">
                    <label class="ui-input-label">API ì œê³µì</label>
                    <select class="ui-input" id="api-provider">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="openai">OpenAI (GPT)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                        <option value="google">Google (Gemini)</option>
                    </select>
                </div>
                <div class="ui-input-group" style="margin-bottom: var(--space-lg);">
                    <label class="ui-input-label">API í‚¤</label>
                    <input type="password" class="ui-input" id="api-key" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="ui-input-group">
                    <label class="ui-input-label">ëª¨ë¸</label>
                    <select class="ui-input" id="api-model">
                        <option value="">API ì œê³µìë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="ui-button ui-button--ghost ui-button--md" onclick="closeAIModal()">
                    ì·¨ì†Œ
                </button>
                <button class="ui-button ui-button--primary ui-button--md" onclick="saveAIConfig()">
                    ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤ - ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€
        let promptData = {
            textInput: '',
            generatedPrompts: [],
            structuredPrompt: {}
        };
        
        let currentStructureTab = 'character';
        let currentFocusedIndex = -1;
        let activeDropdown = null;
        let userEditingPreview = false;
        
        // í•œê¸€ ì œëª© ë§¤í•‘ (ì „ì—­ ë³€ìˆ˜ë¡œ ì´ë™)
        const koreanTitles = {
            'STYLE': 'ìŠ¤íƒ€ì¼',
            'MEDIUM': 'ë§¤ì²´',
            'ERA/CULTURAL_REF': 'ì‹œëŒ€/ë¬¸í™” ì°¸ì¡°',
            'CHARACTER': 'ìºë¦­í„°',
            'CHARACTER_SHEET': 'ìºë¦­í„° ì‹œíŠ¸',
            'GAZE': 'ì‹œì„ ',
            'CAMERA': 'ì¹´ë©”ë¼',
            'LIGHTING': 'ì¡°ëª…',
            'COLOR_TONE': 'ìƒ‰ì¡°',
            'QUALITY': 'í’ˆì§ˆ',
            'BACKGROUND': 'ë°°ê²½',
            'BODY_TYPE': 'ì²´í˜•',
            'HAIR': 'í—¤ì–´',
            'FACE_SHAPE': 'ì–¼êµ´í˜•',
            'FACIAL_FEATURES': 'ì–¼êµ´ íŠ¹ì§•',
            'SKIN': 'í”¼ë¶€',
            'EXPRESSION': 'í‘œì •',
            'CLOTHING': 'ì˜ìƒ',
            'ACCESSORIES': 'ì•¡ì„¸ì„œë¦¬',
            'PROPS': 'ì†Œí’ˆ',
            'POSE': 'í¬ì¦ˆ',
            'PARAMETERS': 'íŒŒë¼ë¯¸í„°'
        };

        // DOM ìš”ì†Œë“¤
        const generateBtn = document.getElementById('generate-prompt-btn');
        const finalPromptSection = document.getElementById('final-prompt-section');
        const finalPromptText = document.getElementById('final-prompt-text');
        const copyFinalPromptBtn = document.getElementById('copy-final-prompt-btn');
        const aiConnectBtn = document.getElementById('ai-connect-btn');
        const promptPreview = document.getElementById('prompt-preview');
        const promptCardsGrid = document.getElementById('prompt-cards-grid');

        // ëª¨ë“  ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìœ ì§€
        function displayFinalPrompt(defaultPrompt) {
            const resolvedStructure = { ...promptData.structuredPrompt };
            const scopeSelector = currentStructureTab === 'character' ? '.character-container' : '.general-container';
            const scope = document.querySelector(scopeSelector);
            
            if (scope) {
                scope.querySelectorAll('.dropdown-container').forEach(container => {
                    const key = container.dataset.key;
                    if (!key) return;
                    const appliedInput = container.querySelector(`input[data-key="${key}-applied"]`);
                    const requestInput = container.querySelector(`input[data-key="${key}-request"]`);
                    const existingInput = container.querySelector(`input[data-key="${key}"]`);
                    
                    const appliedVal = (appliedInput?.value || '').trim();
                    const requestVal = (requestInput?.value || '').trim();
                    const existingVal = (existingInput?.value || '').trim();
                    
                    let finalValue = '';
                    
                    if (appliedVal) {
                        finalValue = appliedVal;
                        if (requestVal && requestVal !== appliedVal) {
                            const englishOnly = requestVal.split(',').map(part => part.trim())
                                .filter(part => !/[ê°€-í£]/.test(part))
                                .join(', ');
                            if (englishOnly) {
                                finalValue = `${appliedVal}, ${englishOnly}`;
                            }
                        }
                    } else if (existingVal) {
                        finalValue = existingVal;
                    }
                    
                    if (finalValue) {
                        resolvedStructure[key] = finalValue;
                    }
                });
            }
            
            const finalValues = Object.values(resolvedStructure).filter(v => v && v.trim());
            const finalPrompt = finalValues.length > 0 
                ? finalValues.join(', ') 
                : (defaultPrompt || 'í”„ë¡¬í”„íŠ¸ êµ¬ì¡°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            
            finalPromptSection.style.display = 'block';
            finalPromptText.value = finalPrompt;
            
            promptData.structuredPrompt = resolvedStructure;
            saveToLocalStorage();
        }

        function loadExamplePrompt() {
            const examplePrompt = `A mystical forest at twilight, ancient trees with glowing runes, 
ethereal mist floating between trunks, bioluminescent plants, magical particles in the air, 
fantasy art style, volumetric lighting, atmospheric perspective, highly detailed, 8k resolution`;
            
            promptPreview.innerText = examplePrompt;
            promptData.textInput = examplePrompt;
            saveToLocalStorage();
        }

        function parsePrompt(text) {
            const categories = {
                'STYLE': ['style', 'art style', 'aesthetic'],
                'MEDIUM': ['medium', 'media', 'technique'],
                'SUBJECT': ['subject', 'character', 'object', 'person'],
                'ENVIRONMENT': ['environment', 'background', 'setting', 'location'],
                'LIGHTING': ['lighting', 'light', 'illumination'],
                'COLOR': ['color', 'colors', 'palette', 'tone'],
                'MOOD': ['mood', 'atmosphere', 'feeling', 'emotion'],
                'COMPOSITION': ['composition', 'framing', 'angle', 'perspective'],
                'QUALITY': ['quality', 'resolution', 'detail']
            };
            
            const structure = {};
            const parts = text.split(',').map(p => p.trim());
            
            parts.forEach(part => {
                for (const [category, keywords] of Object.entries(categories)) {
                    if (keywords.some(keyword => part.toLowerCase().includes(keyword))) {
                        structure[category] = part;
                        break;
                    }
                }
            });
            
            return structure;
        }

        function enhancePrompt(text) {
            const enhancements = [
                'highly detailed',
                'professional photography',
                'award winning',
                'trending on artstation',
                '8k resolution',
                'octane render',
                'unreal engine 5',
                'photorealistic',
                'volumetric lighting',
                'cinematic composition'
            ];
            
            const randomEnhancements = enhancements
                .sort(() => 0.5 - Math.random())
                .slice(0, 3)
                .join(', ');
            
            return `${text}, ${randomEnhancements}`;
        }

        function structureToText(structure) {
            return Object.entries(structure)
                .filter(([key, value]) => value && value.trim())
                .map(([key, value]) => value)
                .join(', ');
        }

        function switchStructureTab(tab) {
            currentStructureTab = tab;
            document.getElementById('structure-tab-character').classList.toggle('active', tab === 'character');
            document.getElementById('structure-tab-general').classList.toggle('active', tab === 'general');
            createPromptCards(promptData.structuredPrompt);
        }

        function switchCharacterSubTab(categoryIndex) {
            const characterContainer = document.querySelector('.character-container');
            if (!characterContainer) return;
            
            const subTabButtons = characterContainer.querySelectorAll('.sub-tab-button');
            const subTabContents = characterContainer.querySelectorAll('.sub-tab-content');
            
            subTabButtons.forEach((btn, idx) => {
                btn.classList.toggle('active', idx === categoryIndex);
            });
            
            subTabContents.forEach((content, idx) => {
                content.classList.toggle('active', idx === categoryIndex);
                content.style.display = idx === categoryIndex ? 'block' : 'none';
            });
        }

        function switchGeneralSubTab(categoryIndex) {
            const generalContainer = document.querySelector('.general-container');
            if (!generalContainer) return;
            
            const subTabButtons = generalContainer.querySelectorAll('.sub-tab-button');
            const subTabContents = generalContainer.querySelectorAll('.sub-tab-content');
            
            subTabButtons.forEach((btn, idx) => {
                btn.classList.toggle('active', idx === categoryIndex);
            });
            
            subTabContents.forEach((content, idx) => {
                content.classList.toggle('active', idx === categoryIndex);
                content.style.display = idx === categoryIndex ? 'block' : 'none';
            });
        }

        function createPromptCards(structure) {
            promptCardsGrid.innerHTML = '';
            
            // ìºë¦­í„° íƒ­ ì¹´í…Œê³ ë¦¬ (ì´ë¯¸ì§€ ê¸°ì¤€)
            // ìŠ¤íƒ€ì¼ ì˜µì…˜ ëª©ë¡ (2025 Midjourney v7 ìµœì‹  ì—…ë°ì´íŠ¸)
            const styleOptions = [
                "Abstract (ì¶”ìƒ)", "Aerial (í•­ê³µ)", "Analog (ì•„ë‚ ë¡œê·¸)", "Animated (ì• ë‹ˆë©”ì´ì…˜)",
                "Architectural Photography (ê±´ì¶• ì‚¬ì§„)", "Art Deco (ì•„ë¥´ë°ì½”)", "Art Nouveau (ì•„ë¥´ëˆ„ë³´)",
                "Baroque (ë°”ë¡œí¬)", "Bauhaus (ë°”ìš°í•˜ìš°ìŠ¤)", "Blobitecture (ë¸”ë¡œë¹„í…ì²˜)", "Brutalism (ë¸Œë£¨íƒˆë¦¬ì¦˜)",
                "Comic Book (ë§Œí™”ì±…)", "Collage (ì½œë¼ì£¼)", "Concept Art (ì»¨ì…‰ ì•„íŠ¸)", "Cottagecore (ì½”í‹°ì§€ì½”ì–´)",
                "Cubism (íë¹„ì¦˜)", "Cyberpunk (ì‚¬ì´ë²„í‘í¬)", "Dadaism (ë‹¤ë‹¤ì´ì¦˜)", "Dark Academia (ë‹¤í¬ ì•„ì¹´ë°ë¯¸ì•„)",
                "Dark Fantasy (ë‹¤í¬ íŒíƒ€ì§€)", "Disney Style (ë””ì¦ˆë‹ˆ ìŠ¤íƒ€ì¼)", "Documentary (ë‹¤íë©˜í„°ë¦¬)",
                "Double Exposure (ì´ì¤‘ ë…¸ì¶œ)", "Dreamcore (ë“œë¦¼ì½”ì–´)", "Expressionism (í‘œí˜„ì£¼ì˜)", "Fantasy (íŒíƒ€ì§€)",
                "Fantasy Illustration (íŒíƒ€ì§€ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜)", "Fashion Photography (íŒ¨ì…˜ ì‚¬ì§„)", "Fauvism (í¬ë¹„ì¦˜)",
                "Film Noir (í•„ë¦„ ëŠì™€ë¥´)", "Food Photography (í‘¸ë“œ ì‚¬ì§„)", "Fresco (í”„ë ˆìŠ¤ì½”)", "Glitchcore (ê¸€ë¦¬ì¹˜ì½”ì–´)",
                "Gothic (ê³ ë”•)", "Graphic Novel (ê·¸ë˜í”½ ë…¸ë¸”)", "Horror (ê³µí¬)", "Hyper-Detailed (í•˜ì´í¼ë””í…Œì¼)",
                "Hyperrealism (í•˜ì´í¼ë¦¬ì–¼ë¦¬ì¦˜)", "Impressionism (ì¸ìƒì£¼ì˜)", "Isometric (ì•„ì´ì†Œë©”íŠ¸ë¦­)",
                "Landscape (í’ê²½)", "Liminal Space (ë¦¬ë¯¸ë„ ìŠ¤í˜ì´ìŠ¤)", "Line Art (ë¼ì¸ ì•„íŠ¸)", "Low Poly (ë¡œìš° í´ë¦¬)",
                "Macro Photography (ë§¤í¬ë¡œ ì‚¬ì§„)", "Manga (ë§ê°€)", "McBling (McBling)", "Minimalism (ë¯¸ë‹ˆë©€ë¦¬ì¦˜)",
                "Neo-Expressionism (ë„¤ì˜¤ í‘œí˜„ì£¼ì˜)", "Neon Art (ë„¤ì˜¨ ì•„íŠ¸)", "Night Photography (ì•¼ê°„ ì‚¬ì§„)",
                "Nostalgiacore (ë…¸ìŠ¤íƒ¤ì§€ì–´ì½”ì–´)", "Paper Illustration (ì¢…ì´ ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜)",
                "Photorealism (í¬í† ë¦¬ì–¼ë¦¬ì¦˜)", "Pixar (í”½ì‚¬)", "Pixel Art (í”½ì…€ ì•„íŠ¸)", "Pointillism (ì ë¬˜ë²•)",
                "Pop Art (íŒ ì•„íŠ¸)", "Portrait (ì´ˆìƒí™”)", "Psychedelic (ì‚¬ì´í‚¤ë¸ë¦­)", "Renaissance (ë¥´ë„¤ìƒìŠ¤)",
                "Retro (ë ˆíŠ¸ë¡œ)", "Retro Futurism (ë ˆíŠ¸ë¡œ í“¨ì²˜ë¦¬ì¦˜)", "Rococo (ë¡œì½”ì½”)", "Romanticism (ë‚­ë§Œì£¼ì˜)",
                "Sketch Style (ìŠ¤ì¼€ì¹˜ ìŠ¤íƒ€ì¼)", "Stained Glass (ìŠ¤í…Œì¸ë“œê¸€ë¼ìŠ¤)", "Steampunk (ìŠ¤íŒ€í‘í¬)",
                "Still Life (ì •ë¬¼í™”)", "Street Photography (ìŠ¤íŠ¸ë¦¬íŠ¸ ì‚¬ì§„)", "Studio Ghibli (ìŠ¤íŠœë””ì˜¤ ì§€ë¸Œë¦¬)",
                "Suprematism (ì ˆëŒ€ì£¼ì˜)", "Surrealism (ì´ˆí˜„ì‹¤ì£¼ì˜)", "Symbolism (ìƒì§•ì£¼ì˜)", "Synthwave (ì‹ ìŠ¤ì›¨ì´ë¸Œ)",
                "Technical Drawing (ê¸°ìˆ  ë„ë©´)", "Tempera (í…œí˜ë¼)", "Traumacore (íŠ¸ë¼ìš°ë§ˆì½”ì–´)", "Vaporwave (ë² ì´í¼ì›¨ì´ë¸Œ)",
                "Voxel Art (ë³µì…€ ì•„íŠ¸)", "Webcore (ì›¹ì½”ì–´)", "Weirdcore (ìœ„ì–´ë“œì½”ì–´)", "Whimsical (ê¸°ë°œí•œ)",
                "Y2K Aesthetic (Y2K ë¯¸í•™)"
            ];

            // ê° ì„¹ì…˜ë³„ ë“œë¡­ë‹¤ìš´ ì˜µì…˜
            const dropdownOptions = {
                STYLE: styleOptions,
                MEDIUM: [
                    "Photography (ì‚¬ì§„)", "3D Modeling (3D ëª¨ë¸ë§)", "Acrylic Painting (ì•„í¬ë¦´í™”)",
                    "Animation (ì• ë‹ˆë©”ì´ì…˜)", "Concept Art (ì»¨ì…‰ ì•„íŠ¸)", "Digital Art (ë””ì§€í„¸ ì•„íŠ¸)",
                    "Illustration (ì¼ëŸ¬ìŠ¤íŠ¸ë ˆì´ì…˜)", "Manga (ë§Œí™”)", "Oil Painting (ìœ í™”)", "Painting (íšŒí™”)",
                    "Pencil Sketch (ì—°í•„ ìŠ¤ì¼€ì¹˜)", "Sketch (ìŠ¤ì¼€ì¹˜)", "Typography (íƒ€ì´í¬ê·¸ë˜í”¼)",
                    "Vector Graphics (ë²¡í„° ê·¸ë˜í”½)", "Watercolor (ìˆ˜ì±„í™”)",
                    "Ballpoint Pen Sketch (ë³¼íœ ìŠ¤ì¼€ì¹˜)", "Chalk Art (ë¶„í•„ ì•„íŠ¸)", "Charcoal Drawing (ëª©íƒ„í™”)",
                    "Colored Pencil (ìƒ‰ì—°í•„)", "Conte (ì½©í…Œ)", "Encaustic Painting (ì™ìŠ¤í™”)",
                    "Fresco (í”„ë ˆìŠ¤ì½”í™”)", "Gouache Painting (ê³¼ìŠˆí™”)", "Ink Drawing (ì‰í¬ ë“œë¡œì‰)",
                    "Line Art (ë¼ì¸ ì•„íŠ¸)", "Marker Art (ë§ˆì»¤ ì•„íŠ¸)", "Pastel Drawing (íŒŒìŠ¤í…”í™”)",
                    "Pen and Ink (íœê³¼ ì‰í¬)", "Stippling (ì ë¬˜í™”)", "Sumi-e (ìˆ˜ë¬µí™”)",
                    "Block Print (ë¸”ë¡ í”„ë¦°íŠ¸)", "Calligraphy (ìº˜ë¦¬ê·¸ë˜í”¼)", "Cyanotype (ì²­ì‚¬ì§„ ì¸í™”)",
                    "Etching (ì—ì¹­)", "Linocut (ë¦¬ë…¸ì»·)", "Lithography (ì„íŒí™”)",
                    "Poster Design (í¬ìŠ¤í„° ë””ìì¸)", "Risograph (ë¦¬ì†Œê·¸ë˜í”„)", "Screen Printing (ì‹¤í¬ìŠ¤í¬ë¦° ì¸ì‡„)",
                    "Woodcut (ëª©íŒí™”)"
                ],
                'ERA/CULTURAL_REF': [
                    "Age of Exploration (ëŒ€í•­í•´ì‹œëŒ€)", "American Revolution (ë¯¸êµ­ ë…ë¦½ ì „ìŸ)",
                    "Crusade (ì‹­ìêµ° ì „ìŸ)", "Fall of the Roman Empire (ë¡œë§ˆ ì œêµ­ì˜ ëª°ë½)",
                    "French Revolution (í”„ë‘ìŠ¤ í˜ëª…)", "Goryeo-Khitan War (ê³ ë ¤-ê±°ë€ ì „ìŸ)",
                    "Hundred Years' War (ë°±ë…„ì „ìŸ)", "Industrial Revolution (ì‚°ì—… í˜ëª…)",
                    "Mongol Empire Conquests (ëª½ê³¨ ì œêµ­ì˜ ì •ë³µ)", "Napoleonic Wars (ë‚˜í´ë ˆì˜¹ ì „ìŸ)",
                    "Renaissance era (ë¥´ë„¤ìƒìŠ¤ ì‹œëŒ€)", "Russian Revolution (ëŸ¬ì‹œì•„ í˜ëª…)",
                    "Sejong the Great Era (ì„¸ì¢…ëŒ€ì™• ì‹œëŒ€)", "Vietnam War (ë² íŠ¸ë‚¨ ì „ìŸ)",
                    "World War I (ì œ1ì°¨ ì„¸ê³„ ëŒ€ì „)", "World War II (ì œ2ì°¨ ì„¸ê³„ ëŒ€ì „)",
                    "Y2K Era (Y2K ì‹œëŒ€)", "Victorian Era (ë¹…í† ë¦¬ì•„ ì‹œëŒ€)",
                    "Medieval (ì¤‘ì„¸)", "Ancient Egypt (ê³ ëŒ€ ì´ì§‘íŠ¸)",
                    "Cyberpunk 2077 (ì‚¬ì´ë²„í‘í¬ 2077)", "Steampunk Victorian (ìŠ¤íŒ€í‘í¬ ë¹…í† ë¦¬ì•„)"
                ],
                CHARACTER: [
                    "Korean male child (í•œêµ­ ë‚¨ì ì–´ë¦°ì´)", "Korean female child (í•œêµ­ ì—¬ì ì–´ë¦°ì´)",
                    "Korean male teen (í•œêµ­ ë‚¨ì ì²­ì†Œë…„)", "Korean female teen (í•œêµ­ ì—¬ì ì²­ì†Œë…„)",
                    "Korean male 20s (í•œêµ­ ë‚¨ì 20ëŒ€)", "Korean female 20s (í•œêµ­ ì—¬ì 20ëŒ€)",
                    "Korean male 30s (í•œêµ­ ë‚¨ì 30ëŒ€)", "Korean female 30s (í•œêµ­ ì—¬ì 30ëŒ€)",
                    "Korean male 40s (í•œêµ­ ë‚¨ì 40ëŒ€)", "Korean female 40s (í•œêµ­ ì—¬ì 40ëŒ€)",
                    "Korean male 50s (í•œêµ­ ë‚¨ì 50ëŒ€)", "Korean female 50s (í•œêµ­ ì—¬ì 50ëŒ€)",
                    "Japanese male teen (ì¼ë³¸ ë‚¨ì ì²­ì†Œë…„)", "Japanese female teen (ì¼ë³¸ ì—¬ì ì²­ì†Œë…„)",
                    "Japanese male 20s (ì¼ë³¸ ë‚¨ì 20ëŒ€)", "Japanese female 20s (ì¼ë³¸ ì—¬ì 20ëŒ€)",
                    "Japanese male 30s (ì¼ë³¸ ë‚¨ì 30ëŒ€)", "Japanese female 30s (ì¼ë³¸ ì—¬ì 30ëŒ€)",
                    "Chinese male 20s (ì¤‘êµ­ ë‚¨ì 20ëŒ€)", "Chinese female 20s (ì¤‘êµ­ ì—¬ì 20ëŒ€)",
                    "Chinese male 30s (ì¤‘êµ­ ë‚¨ì 30ëŒ€)", "Chinese female 30s (ì¤‘êµ­ ì—¬ì 30ëŒ€)",
                    "American male teen (ë¯¸êµ­ ë‚¨ì ì²­ì†Œë…„)", "American female teen (ë¯¸êµ­ ì—¬ì ì²­ì†Œë…„)",
                    "American male 20s (ë¯¸êµ­ ë‚¨ì 20ëŒ€)", "American female 20s (ë¯¸êµ­ ì—¬ì 20ëŒ€)",
                    "American male 30s (ë¯¸êµ­ ë‚¨ì 30ëŒ€)", "American female 30s (ë¯¸êµ­ ì—¬ì 30ëŒ€)",
                    "American male 40s (ë¯¸êµ­ ë‚¨ì 40ëŒ€)", "American female 40s (ë¯¸êµ­ ì—¬ì 40ëŒ€)",
                    "European male 20s (ìœ ëŸ½ ë‚¨ì 20ëŒ€)", "European female 20s (ìœ ëŸ½ ì—¬ì 20ëŒ€)",
                    "European male 30s (ìœ ëŸ½ ë‚¨ì 30ëŒ€)", "European female 30s (ìœ ëŸ½ ì—¬ì 30ëŒ€)",
                    "European male 40s (ìœ ëŸ½ ë‚¨ì 40ëŒ€)", "European female 40s (ìœ ëŸ½ ì—¬ì 40ëŒ€)",
                    "British male 30s (ì˜êµ­ ë‚¨ì 30ëŒ€)", "British female 30s (ì˜êµ­ ì—¬ì 30ëŒ€)",
                    "French male 30s (í”„ë‘ìŠ¤ ë‚¨ì 30ëŒ€)", "French female 30s (í”„ë‘ìŠ¤ ì—¬ì 30ëŒ€)"
                ],
                CHARACTER_SHEET: [
                    "character turnaround sheet, multiple views, same character, front view and face close-up, same character, detailed view (ì…ì²´ìŠ¤íŠ¸ ì „ì‹ )",
                    "photo collage of same person, multiple angles, front portrait, side profile, three-quarter view, consistent person (ì‚¬ì§„ì „ì‹ )",
                    "character face sheet, close-up portraits, same character, front face, side profile, 3/4 angle, facial details (ì…ì²´ìŠ¤íŠ¸ ì–¼êµ´)",
                    "photo collage of same person's face, close-up shots, front portrait, side profile, three-quarter view, consistent face (ì‚¬ì§„ ì–¼êµ´)",
                    "character reference sheet, full body shot and portrait close-up, same character, detailed view (ì…ì²´ìŠ¤íŠ¸ í˜¼í•©)",
                    "photo reference of same person, full body shot and portrait close-up, consistent person, detailed views (ì‚¬ì§„ í˜¼í•©)",
                    "character expression sheet, multiple emotions close-up, same character, face happy, sad, angry, surprised, neutral expressions (ì…ì²´ìŠ¤íŠ¸ í‘œì • í´ë¡œì¦ˆì—…)",
                    "photo collage of facial expressions, close-up emotions, same person, smiling, crying, laughing, serious, thoughtful faces (ì‚¬ì§„ í‘œì • í´ë¡œì¦ˆì—…)"
                ],
                GAZE: [
                    "Direct (ì •ë©´ ì‘ì‹œ)", "Averted (ì‹œì„  íšŒí”¼)", "Downward (ì•„ë˜ìª½ ì‹œì„ )",
                    "Upward (ìœ„ìª½ ì‹œì„ )", "Side Glance (ì˜†ëˆˆì§ˆ)", "Over Shoulder (ì–´ê¹¨ ë„ˆë¨¸ ë³´ê¸°)",
                    "Closed Eyes (ëˆˆ ê°ìŒ)", "Half-lidded (ë°˜ì¯¤ ê°ì€ ëˆˆ)", "Wide Open (í¬ê²Œ ëœ¬ ëˆˆ)",
                    "Squinting (ê°€ëŠ˜ê²Œ ëœ¬ ëˆˆ)", "Winking (ìœ™í¬)", "Rolling Eyes (ëˆˆ êµ´ë¦¬ê¸°)",
                    "Staring (ì‘ì‹œ)", "Dreamy (ëª½í™˜ì ì¸ ì‹œì„ )"
                ],
                CAMERA: [
                    "close-up (í´ë¡œì¦ˆì—…)", "extreme close-up (ìµìŠ¤íŠ¸ë¦¼ í´ë¡œì¦ˆì—…)", "medium shot (ë¯¸ë””ì—„ ìƒ·)", 
                    "medium close-up (ë¯¸ë””ì—„ í´ë¡œì¦ˆì—…)", "full shot (í’€ ìƒ·)", "wide shot (ì™€ì´ë“œ ìƒ·)",
                    "extreme wide shot (ìµìŠ¤íŠ¸ë¦¼ ì™€ì´ë“œ ìƒ·)", "eye level (ì•„ì´ ë ˆë²¨)", "low angle (ë¡œìš° ì•µê¸€)",
                    "high angle (í•˜ì´ ì•µê¸€)", "bird's eye view (ë²„ë“œ ì•„ì´ ë·°)", "worm's eye view (ì›œì¦ˆ ì•„ì´ ë·°)",
                    "dutch angle (ë”ì¹˜ ì•µê¸€)", "over the shoulder (ì˜¤ë²„ ë” ìˆ„ë”)", "point of view (POV)",
                    "aerial view (ê³µì¤‘ ë·°)", "side view (ì¸¡ë©´ ë·°)", "front view (ì •ë©´ ë·°)",
                    "back view (í›„ë©´ ë·°)", "three-quarter view (3/4 ë·°)"
                ],
                LIGHTING: [
                    "natural lighting (ìì—°ê´‘)", "studio lighting (ìŠ¤íŠœë””ì˜¤ ì¡°ëª…)", "golden hour (ê³¨ë“ ì•„ì›Œ)",
                    "blue hour (ë¸”ë£¨ì•„ì›Œ)", "dramatic lighting (ë“œë¼ë§ˆí‹± ì¡°ëª…)", "soft lighting (ë¶€ë“œëŸ¬ìš´ ì¡°ëª…)",
                    "hard lighting (ê°•í•œ ì¡°ëª…)", "rim lighting (ë¦¼ ë¼ì´íŒ…)", "backlighting (ë°±ë¼ì´íŒ…)",
                    "volumetric lighting (ë³¼ë¥˜ë©”íŠ¸ë¦­ ì¡°ëª…)", "cinematic lighting (ì‹œë„¤ë§ˆí‹± ì¡°ëª…)",
                    "neon lighting (ë„¤ì˜¨ ì¡°ëª…)", "candlelight (ì´›ë¶ˆ)", "moonlight (ë‹¬ë¹›)",
                    "sunlight (í–‡ë¹›)", "overcast lighting (íë¦°ë‚  ì¡°ëª…)", "twilight (í™©í˜¼)",
                    "dawn lighting (ìƒˆë²½ ì¡°ëª…)", "dusk lighting (í•´ì§ˆë…˜ ì¡°ëª…)", "spotlight (ìŠ¤í¬íŠ¸ë¼ì´íŠ¸)",
                    "ambient lighting (ì•°ë¹„ì–¸íŠ¸ ì¡°ëª…)", "key lighting (í‚¤ ì¡°ëª…)", "fill lighting (í•„ ì¡°ëª…)",
                    "three-point lighting (3ì  ì¡°ëª…)", "split lighting (ìŠ¤í”Œë¦¿ ì¡°ëª…)"
                ],
                COLOR_TONE: [
                    "warm colors (ë”°ëœ»í•œ ìƒ‰ìƒ)", "cool colors (ì°¨ê°€ìš´ ìƒ‰ìƒ)", "vibrant colors (ì„ ëª…í•œ ìƒ‰ìƒ)",
                    "muted colors (ì°¨ë¶„í•œ ìƒ‰ìƒ)", "pastel colors (íŒŒìŠ¤í…” ìƒ‰ìƒ)", "monochrome (ë‹¨ìƒ‰)",
                    "high contrast (ê³ ëŒ€ë¹„)", "low contrast (ì €ëŒ€ë¹„)", "saturated colors (ì±„ë„ ë†’ì€ ìƒ‰ìƒ)",
                    "desaturated colors (ì±„ë„ ë‚®ì€ ìƒ‰ìƒ)", "neon colors (ë„¤ì˜¨ ìƒ‰ìƒ)", "earthy tones (ìì—°ìŠ¤ëŸ¬ìš´ í†¤)",
                    "metallic colors (ë©”íƒˆë¦­ ìƒ‰ìƒ)", "iridescent colors (ë¬´ì§€ê°œë¹› ìƒ‰ìƒ)", "gradient colors (ê·¸ë ˆì´ë””ì–¸íŠ¸ ìƒ‰ìƒ)"
                ],
                QUALITY: [
                    "highly detailed (ë§¤ìš° ìƒì„¸í•œ)", "photorealistic (í¬í† ë¦¬ì–¼ë¦¬ìŠ¤í‹±)", "8k resolution (8K í•´ìƒë„)",
                    "4k resolution (4K í•´ìƒë„)", "ultra HD (ìš¸íŠ¸ë¼ HD)", "masterpiece (ê±¸ì‘)",
                    "best quality (ìµœê³  í’ˆì§ˆ)", "professional (ì „ë¬¸ì ì¸)", "award winning (ìˆ˜ìƒì‘)",
                    "trending on artstation (ì•„íŠ¸ìŠ¤í…Œì´ì…˜ íŠ¸ë Œë”©)", "octane render (ì˜¥í…Œì¸ ë Œë”)",
                    "unreal engine (ì–¸ë¦¬ì–¼ ì—”ì§„)", "ray tracing (ë ˆì´ íŠ¸ë ˆì´ì‹±)", "sharp focus (ì„ ëª…í•œ ì´ˆì )"
                ]
            };
            
            if (currentStructureTab === 'character') {
                // ìºë¦­í„° íƒ­ ì»¨í…Œì´ë„ˆ
                const characterContainer = document.createElement('div');
                characterContainer.className = 'character-container';
                
                // ìºë¦­í„° í•˜ìœ„ íƒ­
                const subTabs = document.createElement('div');
                subTabs.className = 'character-sub-tabs';
                subTabs.innerHTML = `
                    <div class="sub-tab-buttons">
                        <button type="button" class="sub-tab-button active" data-category="0" onclick="switchCharacterSubTab(0)">ê¸°ë³¸ì •ë³´</button>
                        <button type="button" class="sub-tab-button" data-category="1" onclick="switchCharacterSubTab(1)">ì–¼êµ´/í‘œì •</button>
                        <button type="button" class="sub-tab-button" data-category="2" onclick="switchCharacterSubTab(2)">ì˜ìƒ/ì•¡ì„¸ì„œë¦¬</button>
                    </div>
                `;
                characterContainer.appendChild(subTabs);
                
                // ê¸°ë³¸ì •ë³´ íƒ­ ì»¨í…ì¸ 
                const basicContent = document.createElement('div');
                basicContent.className = 'sub-tab-content active';
                basicContent.dataset.category = '0';
                
                // ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆë“¤ ìƒì„±
                ['STYLE', 'MEDIUM', 'CHARACTER', 'CAMERA', 'GAZE', 'CHARACTER_SHEET'].forEach((key, index) => {
                    const container = createDropdownContainer(key, index + 1, structure[key] || '', dropdownOptions[key] || []);
                    basicContent.appendChild(container);
                });
                
                characterContainer.appendChild(basicContent);
                
                // ì–¼êµ´/í‘œì • íƒ­ ì»¨í…ì¸ 
                const faceContent = document.createElement('div');
                faceContent.className = 'sub-tab-content';
                faceContent.dataset.category = '1';
                faceContent.style.display = 'none';
                faceContent.innerHTML = '<div style="padding: 20px; color: var(--text-secondary);">ì–¼êµ´/í‘œì • ì˜µì…˜ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤</div>';
                characterContainer.appendChild(faceContent);
                
                // ì˜ìƒ/ì•¡ì„¸ì„œë¦¬ íƒ­ ì»¨í…ì¸ 
                const clothingContent = document.createElement('div');
                clothingContent.className = 'sub-tab-content';
                clothingContent.dataset.category = '2';
                clothingContent.style.display = 'none';
                clothingContent.innerHTML = '<div style="padding: 20px; color: var(--text-secondary);">ì˜ìƒ/ì•¡ì„¸ì„œë¦¬ ì˜µì…˜ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤</div>';
                characterContainer.appendChild(clothingContent);
                
                promptCardsGrid.appendChild(characterContainer);
                
            } else {
                // ì¼ë°˜ì´ë¯¸ì§€ íƒ­ ì»¨í…Œì´ë„ˆ
                const generalContainer = document.createElement('div');
                generalContainer.className = 'general-container';
                
                // ì¼ë°˜ í•˜ìœ„ íƒ­
                const subTabs = document.createElement('div');
                subTabs.className = 'general-sub-tabs';
                subTabs.innerHTML = `
                    <div class="sub-tab-buttons">
                        <button type="button" class="sub-tab-button active" data-category="0" onclick="switchGeneralSubTab(0)">ìŠ¤íƒ€ì¼/ë§¤ì²´</button>
                        <button type="button" class="sub-tab-button" data-category="1" onclick="switchGeneralSubTab(1)">ì¥ë©´/í™˜ê²½</button>
                        <button type="button" class="sub-tab-button" data-category="2" onclick="switchGeneralSubTab(2)">ì¹´ë©”ë¼/ì¡°ëª…</button>
                    </div>
                `;
                generalContainer.appendChild(subTabs);
                
                // ìŠ¤íƒ€ì¼/ë§¤ì²´ íƒ­ ì»¨í…ì¸ 
                const styleContent = document.createElement('div');
                styleContent.className = 'sub-tab-content active';
                styleContent.dataset.category = '0';
                
                // ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆë“¤ ìƒì„±
                ['STYLE', 'MEDIUM', 'ERA/CULTURAL_REF', 'COLOR_TONE', 'QUALITY'].forEach((key, index) => {
                    const container = createDropdownContainer(key, index + 1, structure[key] || '', dropdownOptions[key] || []);
                    styleContent.appendChild(container);
                });
                
                generalContainer.appendChild(styleContent);
                
                // ì¥ë©´/í™˜ê²½ íƒ­ ì»¨í…ì¸ 
                const sceneContent = document.createElement('div');
                sceneContent.className = 'sub-tab-content';
                sceneContent.dataset.category = '1';
                sceneContent.style.display = 'none';
                
                ['BACKGROUND', 'LIGHTING', 'ATMOSPHERE'].forEach((key, index) => {
                    const container = createDropdownContainer(key, index + 7, structure[key] || '', dropdownOptions[key] || []);
                    sceneContent.appendChild(container);
                });
                generalContainer.appendChild(sceneContent);
                
                // ì¹´ë©”ë¼/ì¡°ëª… íƒ­ ì»¨í…ì¸ 
                const cameraContent = document.createElement('div');
                cameraContent.className = 'sub-tab-content';
                cameraContent.dataset.category = '2';
                cameraContent.style.display = 'none';
                
                ['CAMERA', 'LIGHTING', 'COLOR_TONE'].forEach((key, index) => {
                    const container = createDropdownContainer(key, index + 10, structure[key] || '', dropdownOptions[key] || []);
                    cameraContent.appendChild(container);
                });
                generalContainer.appendChild(cameraContent);
                
                promptCardsGrid.appendChild(generalContainer);
            }
        }
        
        // ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆ ìƒì„± í•¨ìˆ˜
        function createDropdownContainer(key, number, value, options) {
            const container = document.createElement('div');
            container.className = 'dropdown-container';
            container.dataset.key = key;
            
            const header = document.createElement('div');
            header.className = 'dropdown-header';
            header.onclick = () => toggleDropdown(container);
            
            const titleText = koreanTitles[key] || key;
            
            header.innerHTML = `
                <div class="dropdown-title">
                    <span class="dropdown-number">${number}</span>
                    <span>${titleText}</span>
                </div>
                <i class="ti ti-chevron-down dropdown-arrow"></i>
            `;
            
            const content = document.createElement('div');
            content.className = 'dropdown-content';
            
            const fields = document.createElement('div');
            fields.className = 'dropdown-fields';
            
            // ê¸°ì¡´ë‚´ìš© í•„ë“œ
            const existingField = createField('ê¸°ì¡´ë‚´ìš©', key, value, options, 'existing');
            fields.appendChild(existingField);
            
            // ë³€ê²½ìš”ì²­ í•„ë“œ
            const requestField = createField('ë³€ê²½ìš”ì²­', key + '-request', '', options, 'request');
            fields.appendChild(requestField);
            
            // ë³€ê²½ë°˜ì˜ í•„ë“œ
            const appliedField = createField('ë³€ê²½ë°˜ì˜', key + '-applied', '', options, 'applied');
            fields.appendChild(appliedField);
            
            content.appendChild(fields);
            container.appendChild(header);
            container.appendChild(content);
            
            return container;
        }
        
        // í•„ë“œ ìƒì„± í•¨ìˆ˜
        function createField(label, inputKey, value, options, fieldType) {
            const field = document.createElement('div');
            field.className = 'dropdown-field';
            
            const labelContainer = document.createElement('div');
            labelContainer.className = 'dropdown-field-label-with-buttons';
            
            const labelElement = document.createElement('label');
            labelElement.className = 'dropdown-field-label';
            labelElement.textContent = label;
            
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'field-action-buttons';
            
            if (fieldType === 'applied') {
                const saveBtn = document.createElement('button');
                saveBtn.className = 'btn-field-action btn-save';
                saveBtn.textContent = 'ì €ì¥';
                saveBtn.onclick = () => saveFieldValue(inputKey);
                
                const aiBtn = document.createElement('button');
                aiBtn.className = 'btn-field-action btn-ai-save';
                aiBtn.textContent = 'AIì €ì¥';
                aiBtn.onclick = () => aiSaveFieldValue(inputKey);
                
                buttonContainer.appendChild(saveBtn);
                buttonContainer.appendChild(aiBtn);
            }
            
            labelContainer.appendChild(labelElement);
            labelContainer.appendChild(buttonContainer);
            field.appendChild(labelContainer);
            
            const inputWrapper = document.createElement('div');
            inputWrapper.className = 'select-input-wrapper';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'dropdown-field-input with-select';
            input.dataset.key = inputKey;
            input.value = value;
            input.placeholder = `${label} ì…ë ¥...`;
            input.onchange = () => updateStructureValue(inputKey, input.value);
            
            inputWrapper.appendChild(input);
            
            if (options && options.length > 0) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'dropdown-toggle-btn';
                toggleBtn.innerHTML = '<i class="ti ti-chevron-down"></i>';
                toggleBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleStyleDropdown(toggleBtn);
                };
                
                const dropdown = createStyleDropdown(options, inputKey);
                inputWrapper.appendChild(toggleBtn);
                inputWrapper.appendChild(dropdown);
            }
            
            field.appendChild(inputWrapper);
            
            return field;
        }
        
        // ìŠ¤íƒ€ì¼ ë“œë¡­ë‹¤ìš´ ìƒì„± í•¨ìˆ˜
        function createStyleDropdown(options, inputKey) {
            const dropdown = document.createElement('div');
            dropdown.className = 'style-options-dropdown';
            
            const search = document.createElement('div');
            search.className = 'style-options-search';
            search.innerHTML = '<input type="text" placeholder="ê²€ìƒ‰..." oninput="filterStyleOptions(this)">';
            
            const list = document.createElement('div');
            list.className = 'style-options-list';
            
            options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'style-option';
                optionElement.textContent = option;
                optionElement.onclick = () => selectStyleOption(optionElement, option, inputKey);
                list.appendChild(optionElement);
            });
            
            dropdown.appendChild(search);
            dropdown.appendChild(list);
            
            return dropdown;
        }
        
        // í•„ë“œ ê°’ ì €ì¥ í•¨ìˆ˜
        function saveFieldValue(inputKey) {
            const input = document.querySelector(`input[data-key="${inputKey}"]`);
            if (input) {
                promptData.structuredPrompt[inputKey] = input.value;
                saveToLocalStorage();
                showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            }
        }
        
        // AI ì €ì¥ í•¨ìˆ˜
        function aiSaveFieldValue(inputKey) {
            const input = document.querySelector(`input[data-key="${inputKey}"]`);
            if (input) {
                // AI ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                showToast('AIê°€ ì²˜ë¦¬ì¤‘ì…ë‹ˆë‹¤...', 'info');
                setTimeout(() => {
                    input.value = input.value + ' (AI Enhanced)';
                    promptData.structuredPrompt[inputKey] = input.value;
                    saveToLocalStorage();
                    showToast('AI ì €ì¥ ì™„ë£Œ', 'success');
                }, 1000);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            const toastMessage = document.getElementById('toast-message');
            
            toast.className = `toast ${type} show`;
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toastIcon.className = 'ti ti-check';
            } else if (type === 'error') {
                toastIcon.className = 'ti ti-x';
            } else {
                toastIcon.className = 'ti ti-info-circle';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function saveToLocalStorage() {
            localStorage.setItem('promptBuilderData', JSON.stringify(promptData));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('promptBuilderData');
            if (saved) {
                promptData = JSON.parse(saved);
                if (promptData.textInput) {
                    promptPreview.innerText = promptData.textInput;
                }
                if (Object.keys(promptData.structuredPrompt).length > 0) {
                    createPromptCards(promptData.structuredPrompt);
                }
            }
        }

        function clearPromptInput() {
            promptPreview.innerText = '';
            promptData.textInput = '';
            saveToLocalStorage();
            showToast('í”„ë¡¬í”„íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        function importPromptFromPreview() {
            const text = promptPreview.innerText.trim();
            if (!text) {
                showToast('ê°€ì ¸ì˜¬ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const structure = parsePrompt(text);
            promptData.structuredPrompt = structure;
            createPromptCards(structure);
            saveToLocalStorage();
            showToast('í”„ë¡¬í”„íŠ¸ë¥¼ êµ¬ì¡°ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤.', 'success');
        }

        function toggleDropdown(container) {
            const isActive = container.classList.contains('active');
            
            document.querySelectorAll('.dropdown-container.active').forEach(c => {
                c.classList.remove('active');
            });
            
            if (!isActive) {
                container.classList.add('active');
            }
        }

        function toggleStyleDropdown(button) {
            const wrapper = button.closest('.select-input-wrapper');
            const dropdown = wrapper.querySelector('.style-options-dropdown');
            const isVisible = dropdown.style.display === 'block';
            
            document.querySelectorAll('.style-options-dropdown').forEach(d => {
                d.style.display = 'none';
            });
            document.querySelectorAll('.dropdown-toggle-btn').forEach(b => {
                b.classList.remove('active');
            });
            
            if (!isVisible) {
                dropdown.style.display = 'block';
                button.classList.add('active');
                const searchInput = dropdown.querySelector('.style-options-search input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        }

        function selectStyleOption(element, value, inputKey) {
            const wrapper = element.closest('.select-input-wrapper');
            const input = wrapper.querySelector('.dropdown-field-input');
            const dropdown = wrapper.querySelector('.style-options-dropdown');
            
            input.value = value;
            
            wrapper.querySelectorAll('.style-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            
            dropdown.style.display = 'none';
            wrapper.querySelector('.dropdown-toggle-btn').classList.remove('active');
            
            updateStructureValue(inputKey, value);
        }

        function filterStyleOptions(input) {
            const searchText = input.value.toLowerCase();
            const options = input.closest('.style-options-dropdown').querySelectorAll('.style-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                option.classList.toggle('hidden', !text.includes(searchText));
            });
        }

        function updateStructureValue(key, value) {
            promptData.structuredPrompt[key] = value;
            saveToLocalStorage();
        }

        function closeAIModal() {
            document.getElementById('aiModal').classList.remove('show');
        }

        function saveAIConfig() {
            const provider = document.getElementById('api-provider').value;
            const key = document.getElementById('api-key').value;
            const model = document.getElementById('api-model').value;
            
            if (!provider || !key || !model) {
                showToast('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            const config = { provider, key, model };
            localStorage.setItem('aiApiConfig', JSON.stringify(config));
            closeAIModal();
            showToast('AI ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            
            // í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
            promptPreview.addEventListener('input', function() {
                userEditingPreview = true;
                promptData.textInput = this.innerText;
                saveToLocalStorage();
            });
            
            // ìƒì„± ë²„íŠ¼ ì´ë²¤íŠ¸
            generateBtn.addEventListener('click', function() {
                const text = promptData.textInput || promptPreview.innerText.trim();
                
                if (!text) {
                    showToast('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                
                const prompt = enhancePrompt(text);
                promptData.generatedPrompts.push({
                    timestamp: new Date().toISOString(),
                    input: text,
                    output: prompt
                });
                saveToLocalStorage();
                displayFinalPrompt(prompt);
            });
            
            // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸
            copyFinalPromptBtn.addEventListener('click', function() {
                const text = finalPromptText.value;
                navigator.clipboard.writeText(text).then(() => {
                    showToast('í”„ë¡¬í”„íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }).catch(() => {
                    showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            });
            
            // AI ì—°ë™ ë²„íŠ¼ ì´ë²¤íŠ¸
            aiConnectBtn.addEventListener('click', function() {
                document.getElementById('aiModal').classList.add('show');
            });
            
            // API ì œê³µì ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('api-provider').addEventListener('change', function() {
                const modelSelect = document.getElementById('api-model');
                modelSelect.innerHTML = '';
                
                if (this.value === 'openai') {
                    modelSelect.innerHTML = `
                        <option value="gpt-4">GPT-4</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    `;
                } else if (this.value === 'anthropic') {
                    modelSelect.innerHTML = `
                        <option value="claude-3-opus">Claude 3 Opus</option>
                        <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                    `;
                } else if (this.value === 'google') {
                    modelSelect.innerHTML = `
                        <option value="gemini-pro">Gemini Pro</option>
                        <option value="gemini-pro-vision">Gemini Pro Vision</option>
                    `;
                }
            });
            
            // ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.select-input-wrapper')) {
                    document.querySelectorAll('.style-options-dropdown').forEach(d => {
                        d.style.display = 'none';
                    });
                    document.querySelectorAll('.dropdown-toggle-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                }
            });
        });

        // AI í”„ë¡¬í”„íŠ¸ ìƒì„± í•¨ìˆ˜
        window.generateAIPrompt = function() {
            const text = promptData.textInput || promptPreview.innerText.trim();
            
            if (!text) {
                showToast('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            showToast('AIê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±ì¤‘ì…ë‹ˆë‹¤...', 'info');
            
            // AI ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(() => {
                const aiEnhanced = enhancePrompt(text) + ', masterpiece, best quality';
                displayFinalPrompt(aiEnhanced);
                showToast('AI í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }, 1500);
        };
    </script>
</body>
</html>