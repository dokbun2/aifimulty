<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í”„ë¡¬í”„íŠ¸ ë¹Œë” - AIFI</title>
    <link rel="stylesheet" href="apple-design-system.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: var(--apple-bg-primary);
            color: var(--apple-text-primary);
            padding-top: var(--header-height);
            min-height: 100vh;
        }

        /* Prompt Builder Specific Styles */
        .builder-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-lg);
        }

        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--apple-border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .category-tab {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: transparent;
            border: none;
            color: var(--apple-text-secondary);
            font-size: var(--font-size-body);
            font-weight: 500;
            cursor: pointer;
            position: relative;
            white-space: nowrap;
            transition: color var(--transition-fast);
        }

        .category-tab:hover {
            color: var(--apple-text-primary);
        }

        .category-tab.active {
            color: var(--apple-blue);
        }

        .category-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--apple-blue);
        }

        /* Prompt Elements Grid */
        .prompt-elements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
        }

        .prompt-element {
            padding: var(--spacing-md);
            background: var(--apple-bg-secondary);
            border: 1px solid var(--apple-border);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-caption);
        }

        .prompt-element:hover {
            border-color: var(--apple-blue);
            transform: scale(1.02);
        }

        .prompt-element.selected {
            background: var(--apple-blue);
            color: white;
            border-color: var(--apple-blue);
        }

        .prompt-element-icon {
            font-size: 1.5rem;
            margin-bottom: var(--spacing-xs);
        }

        /* Prompt Preview */
        .prompt-preview {
            background: var(--apple-bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            min-height: 200px;
        }

        .prompt-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .prompt-preview-title {
            font-size: var(--font-size-heading);
            font-weight: 600;
        }

        .prompt-preview-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .prompt-text {
            background: var(--apple-bg-primary);
            border: 1px solid var(--apple-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            min-height: 100px;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: var(--font-size-caption);
            line-height: 1.6;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .prompt-text:empty::before {
            content: 'ì—¬ê¸°ì— í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤...';
            color: var(--apple-text-secondary);
        }

        /* Custom Input Section */
        .custom-input-section {
            background: var(--apple-bg-secondary);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .custom-input {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--apple-bg-primary);
            border: 1px solid var(--apple-border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-body);
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .custom-input:focus {
            outline: none;
            border-color: var(--apple-blue);
        }

        /* Templates Section */
        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .template-card {
            background: var(--apple-bg-secondary);
            border: 1px solid var(--apple-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .template-card:hover {
            border-color: var(--apple-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-card-title {
            font-size: var(--font-size-body);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .template-card-description {
            font-size: var(--font-size-caption);
            color: var(--apple-text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .template-card-preview {
            font-size: var(--font-size-small);
            color: var(--apple-text-secondary);
            background: var(--apple-bg-primary);
            padding: var(--spacing-sm);
            border-radius: var(--radius-sm);
            font-family: 'SF Mono', monospace;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Floating Action Buttons */
        .floating-actions {
            position: fixed;
            bottom: var(--spacing-xl);
            right: var(--spacing-xl);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            z-index: 100;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--apple-blue);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-fast);
            font-size: 1.5rem;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        .fab-secondary {
            background: var(--apple-bg-secondary);
            color: var(--apple-text-primary);
            border: 1px solid var(--apple-border);
        }

        /* History Sidebar */
        .history-sidebar {
            position: fixed;
            right: -400px;
            top: var(--header-height);
            width: 400px;
            height: calc(100vh - var(--header-height));
            background: var(--apple-bg-secondary);
            border-left: 1px solid var(--apple-border);
            transition: right var(--transition-base);
            overflow-y: auto;
            z-index: 99;
        }

        .history-sidebar.open {
            right: 0;
        }

        .history-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--apple-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--apple-border);
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .history-item:hover {
            background: var(--apple-bg-tertiary);
        }

        .history-item-time {
            font-size: var(--font-size-small);
            color: var(--apple-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .history-item-text {
            font-size: var(--font-size-caption);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .builder-container {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .prompt-elements {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .history-sidebar {
                width: 100%;
                right: -100%;
            }

            .floating-actions {
                bottom: var(--spacing-md);
                right: var(--spacing-md);
            }
        }

        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            .prompt-text {
                background: #1a1a1a;
            }

            .custom-input {
                background: #1a1a1a;
            }

            .template-card-preview {
                background: #1a1a1a;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="apple-nav">
        <div class="apple-nav-content">
            <a href="index-apple.html" class="apple-nav-logo">â† AIFI</a>
            <ul class="apple-nav-menu">
                <li><a href="#" class="apple-nav-link">í…œí”Œë¦¿</a></li>
                <li><a href="#" class="apple-nav-link">ê°€ì´ë“œ</a></li>
                <li><a href="#" class="apple-nav-link">íˆìŠ¤í† ë¦¬</a></li>
            </ul>
        </div>
    </nav>

    <div class="builder-container">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="display-title">AI í”„ë¡¬í”„íŠ¸ ë¹Œë”</h1>
            <p class="body-text mt-2">
                ê°„ë‹¨í•œ í´ë¦­ìœ¼ë¡œ ì „ë¬¸ì ì¸ AI ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”
            </p>
        </div>

        <!-- Category Tabs -->
        <div class="category-tabs">
            <button class="category-tab active" data-category="subject">ì£¼ì œ</button>
            <button class="category-tab" data-category="style">ìŠ¤íƒ€ì¼</button>
            <button class="category-tab" data-category="mood">ë¶„ìœ„ê¸°</button>
            <button class="category-tab" data-category="lighting">ì¡°ëª…</button>
            <button class="category-tab" data-category="camera">ì¹´ë©”ë¼</button>
            <button class="category-tab" data-category="color">ìƒ‰ìƒ</button>
            <button class="category-tab" data-category="composition">êµ¬ë„</button>
            <button class="category-tab" data-category="quality">í’ˆì§ˆ</button>
        </div>

        <!-- Prompt Elements -->
        <div id="subject-elements" class="prompt-elements">
            <div class="prompt-element" data-value="portrait of a person">
                <div class="prompt-element-icon">ğŸ‘¤</div>
                <div>ì¸ë¬¼ ì´ˆìƒí™”</div>
            </div>
            <div class="prompt-element" data-value="landscape">
                <div class="prompt-element-icon">ğŸï¸</div>
                <div>í’ê²½</div>
            </div>
            <div class="prompt-element" data-value="fantasy character">
                <div class="prompt-element-icon">ğŸ§™</div>
                <div>íŒíƒ€ì§€ ìºë¦­í„°</div>
            </div>
            <div class="prompt-element" data-value="futuristic city">
                <div class="prompt-element-icon">ğŸŒƒ</div>
                <div>ë¯¸ë˜ ë„ì‹œ</div>
            </div>
            <div class="prompt-element" data-value="abstract art">
                <div class="prompt-element-icon">ğŸ¨</div>
                <div>ì¶”ìƒí™”</div>
            </div>
            <div class="prompt-element" data-value="animal">
                <div class="prompt-element-icon">ğŸ¦</div>
                <div>ë™ë¬¼</div>
            </div>
            <div class="prompt-element" data-value="food photography">
                <div class="prompt-element-icon">ğŸ”</div>
                <div>ìŒì‹</div>
            </div>
            <div class="prompt-element" data-value="architecture">
                <div class="prompt-element-icon">ğŸ›ï¸</div>
                <div>ê±´ì¶•ë¬¼</div>
            </div>
        </div>

        <div id="style-elements" class="prompt-elements" style="display: none;">
            <div class="prompt-element" data-value="photorealistic">
                <div class="prompt-element-icon">ğŸ“·</div>
                <div>í¬í† ë¦¬ì–¼ë¦¬ìŠ¤í‹±</div>
            </div>
            <div class="prompt-element" data-value="digital art">
                <div class="prompt-element-icon">ğŸ–¼ï¸</div>
                <div>ë””ì§€í„¸ ì•„íŠ¸</div>
            </div>
            <div class="prompt-element" data-value="oil painting">
                <div class="prompt-element-icon">ğŸ¨</div>
                <div>ìœ í™”</div>
            </div>
            <div class="prompt-element" data-value="watercolor">
                <div class="prompt-element-icon">ğŸ’§</div>
                <div>ìˆ˜ì±„í™”</div>
            </div>
            <div class="prompt-element" data-value="anime style">
                <div class="prompt-element-icon">â›©ï¸</div>
                <div>ì• ë‹ˆë©”ì´ì…˜</div>
            </div>
            <div class="prompt-element" data-value="3D render">
                <div class="prompt-element-icon">ğŸ®</div>
                <div>3D ë Œë”</div>
            </div>
            <div class="prompt-element" data-value="minimalist">
                <div class="prompt-element-icon">â¬œ</div>
                <div>ë¯¸ë‹ˆë©€ë¦¬ì¦˜</div>
            </div>
            <div class="prompt-element" data-value="cyberpunk">
                <div class="prompt-element-icon">ğŸ¤–</div>
                <div>ì‚¬ì´ë²„í‘í¬</div>
            </div>
        </div>

        <!-- Custom Input Section -->
        <div class="custom-input-section">
            <h3 class="card-title mb-2">ì»¤ìŠ¤í…€ ì„¤ëª… ì¶”ê°€</h3>
            <textarea class="custom-input" placeholder="ì¶”ê°€ë¡œ ì›í•˜ëŠ” ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..." id="customInput"></textarea>
        </div>

        <!-- Prompt Preview -->
        <div class="prompt-preview">
            <div class="prompt-preview-header">
                <h3 class="prompt-preview-title">ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</h3>
                <div class="prompt-preview-actions">
                    <button class="apple-btn apple-btn-secondary" onclick="clearPrompt()">ì´ˆê¸°í™”</button>
                    <button class="apple-btn apple-btn-primary" onclick="copyPrompt()">ë³µì‚¬</button>
                </div>
            </div>
            <div class="prompt-text" id="promptOutput"></div>
        </div>

        <!-- Templates -->
        <h3 class="section-title mb-3">í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</h3>
        <div class="templates-grid">
            <div class="template-card" onclick="applyTemplate('cinematic')">
                <div class="template-card-title">ì‹œë„¤ë§ˆí‹± ì”¬</div>
                <div class="template-card-description">ì˜í™” ê°™ì€ ì¥ë©´ì„ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤</div>
                <div class="template-card-preview">cinematic shot, dramatic lighting, film grain...</div>
            </div>
            <div class="template-card" onclick="applyTemplate('portrait')">
                <div class="template-card-title">í”„ë¡œí˜ì…”ë„ ì´ˆìƒí™”</div>
                <div class="template-card-description">ì „ë¬¸ì ì¸ ì¸ë¬¼ ì‚¬ì§„ ìŠ¤íƒ€ì¼</div>
                <div class="template-card-preview">professional portrait, studio lighting, sharp focus...</div>
            </div>
            <div class="template-card" onclick="applyTemplate('concept')">
                <div class="template-card-title">ì»¨ì…‰ ì•„íŠ¸</div>
                <div class="template-card-description">ê²Œì„ì´ë‚˜ ì˜í™”ìš© ì»¨ì…‰ ì•„íŠ¸</div>
                <div class="template-card-preview">concept art, digital painting, artstation...</div>
            </div>
            <div class="template-card" onclick="applyTemplate('product')">
                <div class="template-card-title">ì œí’ˆ ì‚¬ì§„</div>
                <div class="template-card-description">ê¹”ë”í•œ ì œí’ˆ ì´ë¯¸ì§€</div>
                <div class="template-card-preview">product photography, white background, studio...</div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="floating-actions">
        <button class="fab fab-secondary" onclick="toggleHistory()" title="íˆìŠ¤í† ë¦¬">
            ğŸ“œ
        </button>
        <button class="fab" onclick="generateImage()" title="ì´ë¯¸ì§€ ìƒì„±">
            âœ¨
        </button>
    </div>

    <!-- History Sidebar -->
    <div class="history-sidebar" id="historySidebar">
        <div class="history-header">
            <h3>í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬</h3>
            <button class="apple-btn apple-btn-text" onclick="toggleHistory()">âœ•</button>
        </div>
        <div id="historyList">
            <!-- History items will be added here -->
        </div>
    </div>

    <script>
        // Prompt builder state
        let promptParts = {
            subject: [],
            style: [],
            mood: [],
            lighting: [],
            camera: [],
            color: [],
            composition: [],
            quality: []
        };

        let currentCategory = 'subject';
        let promptHistory = JSON.parse(localStorage.getItem('promptHistory')) || [];

        // Category data
        const categoryData = {
            mood: [
                { icon: 'ğŸ˜Š', text: 'í–‰ë³µí•œ', value: 'happy, joyful' },
                { icon: 'ğŸ˜¢', text: 'ìŠ¬í”ˆ', value: 'sad, melancholic' },
                { icon: 'ğŸ˜¨', text: 'ë¬´ì„œìš´', value: 'scary, horror' },
                { icon: 'ğŸ˜Œ', text: 'í‰í™”ë¡œìš´', value: 'peaceful, calm' },
                { icon: 'ğŸ”¥', text: 'ê°•ë ¬í•œ', value: 'intense, dramatic' },
                { icon: 'ğŸŒ™', text: 'ì‹ ë¹„ë¡œìš´', value: 'mysterious, mystical' },
                { icon: 'ğŸ’­', text: 'ëª½í™˜ì ì¸', value: 'dreamy, surreal' },
                { icon: 'âš¡', text: 'ì—ë„ˆì§€í‹±í•œ', value: 'energetic, dynamic' }
            ],
            lighting: [
                { icon: 'â˜€ï¸', text: 'ìì—°ê´‘', value: 'natural lighting' },
                { icon: 'ğŸŒ…', text: 'ê³¨ë“ ì•„ì›Œ', value: 'golden hour' },
                { icon: 'ğŸŒƒ', text: 'ë„¤ì˜¨', value: 'neon lighting' },
                { icon: 'ğŸ•¯ï¸', text: 'ì´›ë¶ˆ', value: 'candlelight' },
                { icon: 'ğŸ’¡', text: 'ìŠ¤íŠœë””ì˜¤', value: 'studio lighting' },
                { icon: 'ğŸŒ™', text: 'ë‹¬ë¹›', value: 'moonlight' },
                { icon: 'âš¡', text: 'ë“œë¼ë§ˆí‹±', value: 'dramatic lighting' },
                { icon: 'ğŸ”¦', text: 'ë°±ë¼ì´íŠ¸', value: 'backlit' }
            ],
            camera: [
                { icon: 'ğŸ“·', text: 'ê´‘ê°', value: 'wide angle' },
                { icon: 'ğŸ”', text: 'í´ë¡œì¦ˆì—…', value: 'close-up' },
                { icon: 'ğŸ¯', text: 'ë§¤í¬ë¡œ', value: 'macro lens' },
                { icon: 'ğŸŒ', text: 'í”¼ì‰¬ì•„ì´', value: 'fisheye lens' },
                { icon: 'ğŸ“¹', text: 'ì‹œë„¤ë§ˆí‹±', value: 'cinematic shot' },
                { icon: 'ğŸš', text: 'ë“œë¡ ë·°', value: 'aerial view' },
                { icon: 'ğŸ‘ï¸', text: 'ì•„ì´ë ˆë²¨', value: 'eye level' },
                { icon: 'ğŸ”½', text: 'ë¡œìš°ì•µê¸€', value: 'low angle' }
            ],
            color: [
                { icon: 'ğŸŒˆ', text: 'ë¹„ë¹„ë“œ', value: 'vivid colors' },
                { icon: 'âš«', text: 'í‘ë°±', value: 'black and white' },
                { icon: 'ğŸ¨', text: 'íŒŒìŠ¤í…”', value: 'pastel colors' },
                { icon: 'ğŸŒ…', text: 'ì›œí†¤', value: 'warm tones' },
                { icon: 'â„ï¸', text: 'ì¿¨í†¤', value: 'cool tones' },
                { icon: 'ğŸ‚', text: 'ë¹ˆí‹°ì§€', value: 'vintage colors' },
                { icon: 'ğŸ’œ', text: 'ëª¨ë…¸í¬ë¡¬', value: 'monochromatic' },
                { icon: 'âœ¨', text: 'ë©”íƒˆë¦­', value: 'metallic colors' }
            ],
            composition: [
                { icon: 'âš¡', text: 'ì‚¼ë¶„í• ', value: 'rule of thirds' },
                { icon: 'ğŸ¯', text: 'ì¤‘ì•™', value: 'centered composition' },
                { icon: 'ğŸ”„', text: 'ëŒ€ì¹­', value: 'symmetrical' },
                { icon: 'â†—ï¸', text: 'ëŒ€ê°ì„ ', value: 'diagonal composition' },
                { icon: 'ğŸŒ€', text: 'í™©ê¸ˆë¹„', value: 'golden ratio' },
                { icon: 'ğŸ“', text: 'ê¸°í•˜í•™ì ', value: 'geometric' },
                { icon: 'ğŸŒŠ', text: 'ë¦¬ë”©ë¼ì¸', value: 'leading lines' },
                { icon: 'ğŸ–¼ï¸', text: 'í”„ë ˆì„', value: 'framed' }
            ],
            quality: [
                { icon: 'âœ¨', text: 'ë§ˆìŠ¤í„°í”¼ìŠ¤', value: 'masterpiece' },
                { icon: 'ğŸ†', text: 'ìµœê³ í’ˆì§ˆ', value: 'best quality' },
                { icon: 'ğŸ“¸', text: '8K', value: '8K resolution' },
                { icon: 'ğŸ¯', text: 'ë””í…Œì¼', value: 'highly detailed' },
                { icon: 'ğŸ”', text: 'ì„ ëª…í•œ', value: 'sharp focus' },
                { icon: 'ğŸ¨', text: 'ì•„íŠ¸ìŠ¤í…Œì´ì…˜', value: 'trending on artstation' },
                { icon: 'ğŸ’', text: 'ìš¸íŠ¸ë¼', value: 'ultra realistic' },
                { icon: 'ğŸ…', text: 'ìˆ˜ìƒì‘', value: 'award winning' }
            ]
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Category tab listeners
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchCategory(this.dataset.category);
                });
            });

            // Element click listeners
            document.querySelectorAll('.prompt-element').forEach(element => {
                element.addEventListener('click', function() {
                    toggleElement(this);
                });
            });

            // Custom input listener
            document.getElementById('customInput').addEventListener('input', updatePrompt);

            // Load history
            loadHistory();
        });

        // Switch category
        function switchCategory(category) {
            currentCategory = category;
            
            // Update tab styles
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Hide all element grids
            document.querySelectorAll('.prompt-elements').forEach(grid => {
                grid.style.display = 'none';
            });
            
            // Show or create category elements
            let elementGrid = document.getElementById(`${category}-elements`);
            if (!elementGrid) {
                elementGrid = createElementGrid(category);
            }
            elementGrid.style.display = 'grid';
        }

        // Create element grid for category
        function createElementGrid(category) {
            const container = document.querySelector('.category-tabs').parentElement;
            const grid = document.createElement('div');
            grid.id = `${category}-elements`;
            grid.className = 'prompt-elements';
            grid.style.display = 'none';
            
            if (categoryData[category]) {
                categoryData[category].forEach(item => {
                    const element = document.createElement('div');
                    element.className = 'prompt-element';
                    element.dataset.value = item.value;
                    element.innerHTML = `
                        <div class="prompt-element-icon">${item.icon}</div>
                        <div>${item.text}</div>
                    `;
                    element.addEventListener('click', function() {
                        toggleElement(this);
                    });
                    grid.appendChild(element);
                });
            }
            
            // Insert after tabs
            const existingGrids = container.querySelectorAll('.prompt-elements');
            if (existingGrids.length > 0) {
                existingGrids[0].parentElement.insertBefore(grid, existingGrids[0]);
            } else {
                container.appendChild(grid);
            }
            
            return grid;
        }

        // Toggle element selection
        function toggleElement(element) {
            element.classList.toggle('selected');
            const value = element.dataset.value;
            
            if (element.classList.contains('selected')) {
                if (!promptParts[currentCategory].includes(value)) {
                    promptParts[currentCategory].push(value);
                }
            } else {
                const index = promptParts[currentCategory].indexOf(value);
                if (index > -1) {
                    promptParts[currentCategory].splice(index, 1);
                }
            }
            
            updatePrompt();
        }

        // Update prompt display
        function updatePrompt() {
            let prompt = [];
            
            // Add selected elements
            Object.keys(promptParts).forEach(category => {
                if (promptParts[category].length > 0) {
                    prompt.push(...promptParts[category]);
                }
            });
            
            // Add custom input
            const customText = document.getElementById('customInput').value.trim();
            if (customText) {
                prompt.push(customText);
            }
            
            document.getElementById('promptOutput').textContent = prompt.join(', ');
        }

        // Clear prompt
        function clearPrompt() {
            promptParts = {
                subject: [],
                style: [],
                mood: [],
                lighting: [],
                camera: [],
                color: [],
                composition: [],
                quality: []
            };
            
            document.querySelectorAll('.prompt-element').forEach(element => {
                element.classList.remove('selected');
            });
            
            document.getElementById('customInput').value = '';
            document.getElementById('promptOutput').textContent = '';
        }

        // Copy prompt
        function copyPrompt() {
            const promptText = document.getElementById('promptOutput').textContent;
            if (!promptText) {
                alert('í”„ë¡¬í”„íŠ¸ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            navigator.clipboard.writeText(promptText).then(() => {
                // Save to history
                saveToHistory(promptText);
                
                // Show feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'ë³µì‚¬ë¨!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // Apply template
        function applyTemplate(type) {
            const templates = {
                cinematic: 'cinematic shot, dramatic lighting, film grain, anamorphic lens, depth of field, moody atmosphere, color grading, 8K resolution',
                portrait: 'professional portrait, studio lighting, sharp focus, shallow depth of field, bokeh background, natural skin tones, high resolution, detailed',
                concept: 'concept art, digital painting, trending on artstation, highly detailed, professional, dramatic lighting, fantasy art, epic composition',
                product: 'product photography, white background, studio lighting, clean, minimalist, high resolution, commercial photography, sharp focus'
            };
            
            document.getElementById('customInput').value = templates[type];
            updatePrompt();
        }

        // Generate image (placeholder)
        function generateImage() {
            const promptText = document.getElementById('promptOutput').textContent;
            if (!promptText) {
                alert('í”„ë¡¬í”„íŠ¸ë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            saveToHistory(promptText);
            alert('ì´ë¯¸ì§€ ìƒì„± ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.\n\nìƒì„±ëœ í”„ë¡¬í”„íŠ¸:\n' + promptText);
        }

        // Toggle history sidebar
        function toggleHistory() {
            document.getElementById('historySidebar').classList.toggle('open');
        }

        // Save to history
        function saveToHistory(prompt) {
            const historyItem = {
                prompt: prompt,
                timestamp: new Date().toISOString()
            };
            
            promptHistory.unshift(historyItem);
            if (promptHistory.length > 50) {
                promptHistory = promptHistory.slice(0, 50);
            }
            
            localStorage.setItem('promptHistory', JSON.stringify(promptHistory));
            loadHistory();
        }

        // Load history
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            if (promptHistory.length === 0) {
                historyList.innerHTML = '<div style="padding: var(--spacing-lg); text-align: center; color: var(--apple-text-secondary);">íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            promptHistory.forEach(item => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'history-item';
                historyDiv.onclick = () => {
                    document.getElementById('customInput').value = item.prompt;
                    updatePrompt();
                    toggleHistory();
                };
                
                const date = new Date(item.timestamp);
                const timeString = date.toLocaleString('ko-KR');
                
                historyDiv.innerHTML = `
                    <div class="history-item-time">${timeString}</div>
                    <div class="history-item-text">${item.prompt}</div>
                `;
                
                historyList.appendChild(historyDiv);
            });
        }
    </script>
</body>
</html>